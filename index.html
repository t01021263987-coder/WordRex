<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WordRex - Vocabulary Master</title>
    <style>
        :root { --wm-yellow: #FFD400; --wm-navy: #004680; --wm-red: #ff4d4d; --wm-green: #28a745; --wm-blue: #2196F3; }
        body { margin: 0; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; background: #f4f4f4; font-family: 'Pretendard', sans-serif; }

        /* ìƒë‹¨ ì§„í–‰ë¥  */
        #progress-box { position: fixed; top: 20px; left: 20px; font-size: 1.5rem; font-weight: bold; color: var(--wm-navy); z-index: 50; display: none; }

        /* íƒ€ì„ ë°” */
        #time-bar-container { position: fixed; right: 30px; top: 50%; transform: translateY(-50%); width: 20px; height: 300px; background: #ddd; border-radius: 10px; overflow: hidden; display: none; }
        #time-bar-fill { width: 100%; height: 100%; background: var(--wm-red); position: absolute; top: 0; }

        /* ë ˆì´ì•„ì›ƒ ì œì–´ */
        #setup-screen, #test-screen, #result-screen, #ranking-screen, #wrong-note-screen { width: 100%; max-width: 500px; text-align: center; display: none; }
        #main-menu { display: block; text-align: center; }

        /* ë‹¨ì–´ì¥ í‘œì§€ (ë²„ê·¸ ìˆ˜ì •: ë°°ê²½ìƒ‰ ì¶”ê°€ ë° ë””ìì¸ ë³´ê°•) */
        .book-card { 
            width: 280px; height: 400px; margin: auto; position: relative; border-radius: 15px; 
            overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            background: var(--wm-navy); /* ê¸°ë³¸ ë°°ê²½ìƒ‰ */
            background-image: url('cover.png'); 
            background-size: cover; background-position: center;
            cursor: pointer; 
        }
        .book-card .cover-content {
            position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white;
        }
        .book-card .overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.7); display: flex; flex-direction: column; 
            justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s; 
            color: white; padding: 20px; box-sizing: border-box; z-index: 2;
        }
        .book-card:hover .overlay { opacity: 1; }

        /* í€´ì¦ˆ UI */
        .quiz-container { background: white; padding: 40px; border-radius: 25px; border-top: 10px solid var(--wm-yellow); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .word-eng { font-size: 3.5rem; color: var(--wm-navy); margin-bottom: 20px; }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .opt-btn { padding: 15px; border: none; background: #f0f0f0; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: 0.2s; }
        .opt-btn:disabled { opacity: 0.3; }

        /* ì¹´ìš´íŠ¸ë‹¤ìš´ */
        #countdown { position: fixed; display: none; font-size: 10rem; color: var(--wm-yellow); font-weight: 900; text-shadow: 8px 8px 0px var(--wm-navy), -4px -4px 0px var(--wm-navy); z-index: 200; }

        /* í”¼ë“œë°± ë ˆì´ì–´ */
        #feedback-layer { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; opacity: 0; z-index: 100; text-align: center; }
        #feedback-points { font-size: 4.5rem; font-weight: 900; }

        /* ë²„íŠ¼ë¥˜ */
        .action-btn { width: 100%; padding: 18px; margin: 8px 0; border: none; border-radius: 12px; font-size: 1.3rem; cursor: pointer; background: white; color: var(--wm-navy); font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s; }
        .action-btn:hover { background: var(--wm-yellow); }
        .rank-go-btn { background: var(--wm-blue); color: white; }
        .wrong-go-btn { background: #6c757d; color: white; }
        .battle-btn { background: var(--wm-red); color: white; } /* ì˜¤ë‹µ ë¿Œì‹œëŸ¬ ê°€ê¸° ë²„íŠ¼ */

        /* ì˜¤ë‹µë…¸íŠ¸ ë¦¬ìŠ¤íŠ¸ */
        .wrong-list { max-height: 350px; overflow-y: auto; background: white; border-radius: 15px; padding: 10px; text-align: left; margin-bottom: 20px; border: 1px solid #eee; }
        .wrong-item { padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-size: 1.2rem; }
        .wrong-item .eng-part { font-weight: bold; color: var(--wm-navy); }
        .wrong-item .kor-part { color: var(--wm-red); }
    </style>
</head>
<body>

    <div id="progress-box"><span id="curr-num">0</span> / <span id="total-num">0</span></div>
    <div id="time-bar-container"><div id="time-bar-fill"></div></div>
    <div id="countdown"></div>

    <div id="main-menu">
        <div id="main-title" style="font-size: 3rem; font-weight: 900; color: var(--wm-navy); margin-bottom: 20px;">WordRex</div>
        <div class="book-card" onclick="showSetup()">
            <div class="cover-content">
                <div style="font-size: 1.2rem; opacity: 0.8;">VOCABULARY</div>
                <div style="font-size: 2rem; font-weight: bold;">ê³ ë“± í•„ìˆ˜ 1200</div>
            </div>
            <div class="overlay">
                <div style="color:var(--wm-yellow); font-size: 1.5rem;">â­â­â­</div>
                <p>í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</p>
                <div style="background:var(--wm-yellow); color:var(--wm-navy); padding:10px 20px; border-radius:20px; font-weight:bold;">CLICK TO START</div>
            </div>
        </div>
    </div>

    <div id="setup-screen">
        <h2 style="color:var(--wm-navy);">ë¬¸í•­ ìˆ˜ ì„ íƒ</h2>
        <button class="action-btn" onclick="initGame(5)">5 ë¬¸í•­</button>
        <button class="action-btn" onclick="initGame(15)">15 ë¬¸í•­</button>
        <button class="action-btn" onclick="initGame(30)">30 ë¬¸í•­</button>
    </div>

    <div id="test-screen">
        <div class="quiz-container">
            <div class="word-eng" id="word-display">Word</div>
            <div class="option-grid" id="option-area"></div>
            <div style="margin-top:25px; font-weight: bold; font-size: 1.3rem;">Score: <span id="score">0</span></div>
        </div>
    </div>

    <div id="result-screen">
        <h2 style="color:#666;">TEST COMPLETE</h2>
        <div style="font-size:5rem; font-weight:900; color:var(--wm-navy); margin-bottom: 20px;" id="final-score">0</div>
        <button class="action-btn" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
        <button id="wrong-note-btn" class="action-btn wrong-go-btn" onclick="showWrongNote()">âœï¸ ì˜¤ë‹µë…¸íŠ¸ í™•ì¸</button>
    </div>

    <div id="wrong-note-screen">
        <h2 style="color:var(--wm-navy);">í‹€ë¦° ë‹¨ì–´ (<span id="wrong-count">0</span>)</h2>
        <div class="wrong-list" id="wrong-list-container"></div>
        <button class="action-btn battle-btn" onclick="startWrongOnlyGame()">ğŸ”¥ ì˜¤ë‹µ ë¿Œì‹œëŸ¬ ê°€ê¸°</button>
        <button class="action-btn" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <div id="feedback-layer">
        <img id="feedback-img" src="" style="width: 250px; opacity: 0.4;">
        <div id="feedback-points"></div>
    </div>

    <audio id="snd-correct" src="correct.mp3"></audio>
    <audio id="snd-wrong" src="wrong.mp3"></audio>

    <script>
        const wordData = [
            { eng: "include", kor: "í¬í•¨í•˜ë‹¤", opts: ["ì œì™¸í•˜ë‹¤", "í¬í•¨í•˜ë‹¤", "ë§‰ë‹¤", "ì˜ˆì¸¡í•˜ë‹¤", "ì¤‘ìš”ì„±"] },
            { eng: "produce", kor: "ìƒì‚°í•˜ë‹¤", opts: ["ì†Œë©¸í•˜ë‹¤", "ìƒì‚°í•˜ë‹¤", "ê°ì†Œí•˜ë‹¤", "ê³µìœ í•˜ë‹¤", "í‰ê°€í•˜ë‹¤"] },
            { eng: "belief", kor: "ë¯¿ìŒ", opts: ["ë¶ˆì‹ ", "ë¯¿ìŒ", "ê±°ë¶€", "í‘œí˜„", "ì‹¤í˜„"] },
            { eng: "similar", kor: "ë¹„ìŠ·í•œ", opts: ["ë¹„ìŠ·í•œ", "ë‹¬ë¼ì§„", "ì¤‘ìš”í•œ", "í–‰ë™í•˜ë‹¤", "ì„±ì¥"] },
            { eng: "moment", kor: "ìˆœê°„", opts: ["ìˆœê°„", "ì˜ˆì¸¡í•˜ë‹¤", "í¬í•¨í•˜ë‹¤", "ê°ì •", "ê³µê¸‰í•˜ë‹¤"] },
            { eng: "emotion", kor: "ê°ì •", opts: ["ê°ì •", "ê³µê¸‰", "í‘œí˜„", "ë°œìƒ", "ì°¨ì´"] },
            { eng: "common", kor: "í”í•œ", opts: ["í¬ê·€í•œ", "í”í•œ", "ìƒê¸‰ì˜", "ë¶€ì •", "ì‹¤ìš©ì ì¸"] },
            { eng: "recover", kor: "íšŒë³µí•˜ë‹¤", opts: ["íšŒë³µí•˜ë‹¤", "ì œê³µí•˜ë‹¤", "ì´í•´í•˜ë‹¤", "ë°œìƒí•˜ë‹¤", "ì‹¤íŒ¨"] },
            { eng: "advanced", kor: "ì§„ë³´í•œ", opts: ["ê¸°ì´ˆì ì¸", "ì§„ë³´í•œ", "ì¼ë°˜ì ì¸", "ê±°ë¶€í•˜ëŠ”", "í‘œí˜„í•˜ëŠ”"] },
            { eng: "indifferent", kor: "ë¬´ê´€ì‹¬í•œ", opts: ["ë¬´ê´€ì‹¬í•œ", "ê³µê¸‰í•˜ëŠ”", "ê³µìœ í•˜ëŠ”", "ì¤‘ìš”í•œ", "í¬í•¨í•˜ë‹¤"] },
            { eng: "consider", kor: "ê³ ë ¤í•˜ë‹¤", opts: ["ê³ ë ¤í•˜ë‹¤", "ë¬´ì‹œí•˜ë‹¤", "íšŒë³µí•˜ë‹¤", "ì œê³µí•˜ë‹¤", "í‘œí˜„í•˜ë‹¤"] },
            { eng: "supply", kor: "ê³µê¸‰í•˜ë‹¤", opts: ["ê³µê¸‰í•˜ë‹¤", "ê±°ë¶€í•˜ë‹¤", "ìƒì‚°í•˜ë‹¤", "ì„±ê³µí•˜ë‹¤", "ê°ì •"] },
            { eng: "practical", kor: "ì‹¤ìš©ì ì¸", opts: ["ì‹¤ìš©ì ì¸", "ì´ë¡ ì ì¸", "ê°ì •ì ì¸", "ì„±ê³µì ì¸", "ë¬´ê´€ì‹¬í•œ"] },
            { eng: "express", kor: "í‘œí˜„í•˜ë‹¤", opts: ["í‘œí˜„í•˜ë‹¤", "ìˆ¨ê¸°ë‹¤", "ê±°ë¶€í•˜ë‹¤", "ì¤‘ìš”í•˜ë‹¤", "í¬í•¨í•˜ë‹¤"] },
            { eng: "fade", kor: "í¬ë¯¸í•´ì§€ë‹¤", opts: ["í¬ë¯¸í•´ì§€ë‹¤", "ì„±ê³µí•˜ë‹¤", "ì œê³µí•˜ë‹¤", "ê°ì •", "íšŒë³µí•˜ë‹¤"] },
            { eng: "disappear", kor: "ì‚¬ë¼ì§€ë‹¤", opts: ["ë‚˜íƒ€ë‚˜ë‹¤", "ì‚¬ë¼ì§€ë‹¤", "ë°œìƒí•˜ë‹¤", "ê°ì •", "í¬í•¨í•˜ë‹¤"] },
            { eng: "emerge", kor: "ë‚˜íƒ€ë‚˜ë‹¤", opts: ["ì‚¬ë¼ì§€ë‹¤", "ë‚˜íƒ€ë‚˜ë‹¤", "í¬í•¨í•˜ë‹¤", "ì„±ê³µí•˜ë‹¤", "í‘œí˜„í•˜ë‹¤"] },
            { eng: "grief", kor: "ìŠ¬í””", opts: ["ìŠ¬í””", "ê¸°ì¨", "ì¤‘ìš”ì„±", "ì‹¤ìš©ì ", "ê°ì •"] },
            { eng: "slight", kor: "ì•½ê°„ì˜", opts: ["ì•½ê°„ì˜", "ì¤‘ëŒ€í•œ", "ì„±ê³µì ì¸", "ê°ì •", "í¬í•¨í•˜ë‹¤"] },
            { eng: "success", kor: "ì„±ê³µ", opts: ["ì‹¤íŒ¨", "ì„±ê³µ", "ê°ì •", "í¬í•¨í•˜ë‹¤", "ì¤‘ìš”"] }
        ];

        let gameWords = [];
        let currentIdx = 0;
        let score = 0;
        let isClickable = false;
        let timerInterval;
        let timeLeft = 8;
        let wrongWords = []; 

        function showSetup() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'block';
        }

        // ê²Œì„ ì´ˆê¸°í™” ê³µí†µ ë¡œì§
        function initGame(count) {
            gameWords = [...wordData].sort(() => Math.random() - 0.5).slice(0, count);
            resetAndStart();
        }

        // ì˜¤ë‹µìœ¼ë¡œë§Œ ê²Œì„ ì‹œì‘
        function startWrongOnlyGame() {
            if(wrongWords.length === 0) return;
            gameWords = [...wrongWords].sort(() => Math.random() - 0.5);
            document.getElementById('wrong-note-screen').style.display = 'none';
            resetAndStart();
        }

        function resetAndStart() {
            currentIdx = 0;
            score = 0;
            wrongWords = []; 
            document.getElementById('score').innerText = score;
            document.getElementById('total-num').innerText = gameWords.length;
            document.getElementById('setup-screen').style.display = 'none';
            startCountdown();
        }

        function startCountdown() {
            const countEl = document.getElementById('countdown');
            countEl.style.display = 'block';
            const sequence = ["3", "2", "1", "GO!"];
            let i = 0;
            const timer = setInterval(() => {
                if (i < sequence.length) {
                    countEl.innerText = sequence[i++];
                } else {
                    clearInterval(timer);
                    countEl.style.display = 'none';
                    document.getElementById('progress-box').style.display = 'block';
                    document.getElementById('test-screen').style.display = 'block';
                    document.getElementById('time-bar-container').style.display = 'block';
                    loadQuestion();
                }
            }, 800);
        }

        function loadQuestion() {
            if (currentIdx >= gameWords.length) {
                endGame();
                return;
            }
            isClickable = true;
            timeLeft = 8;
            updateTimeBar();
            document.getElementById('curr-num').innerText = currentIdx + 1;
            const q = gameWords[currentIdx];
            document.getElementById('word-display').innerText = q.eng;

            const optArea = document.getElementById('option-area');
            optArea.innerHTML = "";
            [...q.opts].sort(() => Math.random() - 0.5).forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, btn);
                optArea.appendChild(btn);
            });

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                updateTimeBar();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    checkAnswer("TIME_OUT", null);
                }
            }, 100);
        }

        function updateTimeBar() {
            const fill = document.getElementById('time-bar-fill');
            fill.style.height = (timeLeft / 8 * 100) + "%";
        }

        function checkAnswer(input, btn) {
            if (!isClickable) return;
            const currentWord = gameWords[currentIdx];
            const correct = currentWord.kor;
            const layer = document.getElementById('feedback-layer');
            const img = document.getElementById('feedback-img');
            const pts = document.getElementById('feedback-points');

            if (input === correct) {
                isClickable = false;
                clearInterval(timerInterval);
                score += 100;
                document.getElementById('snd-correct').play().catch(()=>{});
                img.src = "good.png";
                pts.innerText = "+100";
                pts.style.color = "var(--wm-green)";
                layer.style.opacity = "1";
                setTimeout(() => { 
                    layer.style.opacity = "0";
                    currentIdx++; 
                    loadQuestion(); 
                }, 800);
            } else {
                isClickable = false;
                score -= 50;
                if (!wrongWords.find(w => w.eng === currentWord.eng)) {
                    wrongWords.push(currentWord);
                }
                document.getElementById('snd-wrong').play().catch(()=>{});
                img.src = "ë˜¥.png";
                pts.innerText = "-50";
                pts.style.color = "var(--wm-red)";
                if (btn) btn.disabled = true;
                layer.style.opacity = "1";
                setTimeout(() => { 
                    layer.style.opacity = "0"; 
                    if (input === "TIME_OUT" || true) { // í‹€ë ¤ë„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ê²Œ ì„¤ì • (ì˜¤ë‹µ ë¿Œì‹œê¸° íš¨ìœ¨ ìœ„í•´)
                        currentIdx++;
                        loadQuestion();
                    }
                }, 800);
            }
            document.getElementById('score').innerText = score;
        }

        function endGame() {
            document.getElementById('test-screen').style.display = 'none';
            document.getElementById('time-bar-container').style.display = 'none';
            document.getElementById('progress-box').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-score').innerText = score;
            const wrongBtn = document.getElementById('wrong-note-btn');
            wrongBtn.style.display = wrongWords.length === 0 ? 'none' : 'block';
        }

        function showWrongNote() {
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('wrong-note-screen').style.display = 'block';
            document.getElementById('wrong-count').innerText = wrongWords.length;
            const container = document.getElementById('wrong-list-container');
            container.innerHTML = "";
            wrongWords.forEach(w => {
                const item = document.createElement('div');
                item.className = 'wrong-item';
                item.innerHTML = `<span class="eng-part">${w.eng}</span><span class="kor-part">${w.kor}</span>`;
                container.appendChild(item);
            });
        }
    </script>
</body>
</html>
